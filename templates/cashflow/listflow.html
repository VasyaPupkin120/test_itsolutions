{% extends 'cashflow/_base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block page_title %}–î–≤–∏–∂–µ–Ω–∏—è –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤{% endblock %}

{% block content %}
    <form id="filter-form" method="GET">
        <!-- –ù–∞—á–∞–ª—å–Ω–æ–µ –∏ –∫–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è -->
        <div class="form-group">
            <label for="start_datetime">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è</label>
            <input type="datetime-local" id="start_datetime" name="start_datetime" class="form-control">
        </div>

        <div class="form-group">
            <label for="end_datetime">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è</label>
            <input type="datetime-local" id="end_datetime" name="end_datetime" class="form-control">
        </div>

        <!-- –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
        <div class="form-group">
            <label for="typeflow">–¢–∏–ø</label>
            <select id="typeflow" name="typeflow" class="form-control">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </select>
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="form-group">
            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="category" name="category" class="form-control" disabled>
                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
            </select>
        </div>

        <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="form-group">
            <label for="subcategory">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="subcategory" name="subcategory" class="form-control" disabled>
                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            </select>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <div class="form-group">
            <label for="status">–°—Ç–∞—Ç—É—Å</label>
            <select id="status" name="status" class="form-control">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </select>
        </div>

        <button type="submit" class="btn btn-primary">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
    </form>

    <br>
    <hr>

    <h3>–°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th></th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for flow in object_list %}
                    <tr>
                        <td><a href="#% url '#' flow.pk %}" class="btn btn-sm btn-link text-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé </a></td>
                        <td>{{ flow.created_at|date:"d.m.Y" }}</td>
                        <td>{{ flow.amount }} ‚ÇΩ</td>
                        <td>{{ flow.typeflow.name }}</td>
                        <td>{{ flow.category.name }}</td>
                        <td>{{ flow.subcategory.name }}</td>
                        <td>{{ flow.status.name }}</td>
                        <td>{{ flow.comment }}</td>
                        <td><a href="#% url '#' flow.pk %}" class="btn btn-sm btn-link text-primary" title="–£–¥–∞–ª–∏—Ç—å">üóë</a></td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <br>
    <br>
    <br>
    <br>
    <br>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // –î–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ—Å—Ç–∞
    const filterData = JSON.parse('{{ filter_data|escapejs }}');

    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
    const typeflowSelect = document.getElementById('typeflow');
    const categorySelect = document.getElementById('category');
    const subcategorySelect = document.getElementById('subcategory');
    const statusSelect = document.getElementById('status');

    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è
    fillSelect(typeflowSelect, filterData.typeflows);
    fillSelect(statusSelect, filterData.statuses);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞
    typeflowSelect.addEventListener('change', function() {
        const selectedType = this.value;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏ –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–ª—è
        categorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
        subcategorySelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
        subcategorySelect.disabled = true;
        
        if (selectedType) {
            // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
            const allowedCategories = filterData.typeflows_and_categories[selectedType];
            fillSelect(categorySelect, allowedCategories);
            categorySelect.disabled = allowedCategories.length === 0;
        } else {
            categorySelect.disabled = true;
        }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    categorySelect.addEventListener('change', function() {
        const selectedCategory = this.value;
        subcategorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
        
        if (selectedCategory) {
            const allowedSubcategories = filterData.categories_and_subcategories[selectedCategory] || [];
            fillSelect(subcategorySelect, allowedSubcategories);
            subcategorySelect.disabled = allowedSubcategories.length === 0;
        } else {
            subcategorySelect.disabled = true;
        }
    });

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è select
    function fillSelect(selectElement, options) {
        options.forEach(option => {
            const opt = document.createElement('option');
            opt.value = option;
            opt.textContent = option;
            selectElement.appendChild(opt);
        });
    }
});


</script>

{% endblock %}
